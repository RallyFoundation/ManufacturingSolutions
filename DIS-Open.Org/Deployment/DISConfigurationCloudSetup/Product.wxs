<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!--<?Include $(var.ProjectDir)\Properties.wxs ?>-->
  <?Include $(var.ProjectDir)\Wizard.wxs ?>
  <?Include $(var.ProjectDir)\DISConfigurationCloud.wxs ?>
  <?Include $(var.ProjectDir)\DatabaseComponent.wxs ?>
  
	<Product Id="{3FEB3DB2-F65D-4BFD-8EE1-4D6950064A3E}" Name="DIS Configuration Cloud" Language="1033" Version="1.0.0.0" Manufacturer="Microsoft Corporation" UpgradeCode="{22696E5F-9543-45E1-AC38-99FF975711BF}">
		<Package InstallerVersion="400" Compressed="yes" Languages="1033" Manufacturer="Microsoft Corporation" Platform="x86" />
    <Property Id="PREVIOUSVERSIONSINSTALLED" Secure="yes" />
    <Upgrade Id="{E4B60AFF-5CD3-4105-A750-34155A65B1E6}">
      <UpgradeVersion
         Minimum="0.0.0.0" Maximum="1.0.0.0"
         Property="PREVIOUSVERSIONSINSTALLED"
         IncludeMinimum="no" IncludeMaximum="yes" />
    </Upgrade>
    <MajorUpgrade DowngradeErrorMessage="!(loc.DowngradeErrMessage)" Schedule="afterInstallValidate" />
    <!--<Condition Message="!(loc.RequireNetFramework40)">Installed OR (NETFRAMEWORK40FULL_SERVICING_LEVEL)</Condition>-->
    <Condition Message="!(loc.RequireNetFramework40)">NETFRAMEWORK40FULL_SERVICING_LEVEL</Condition>
    <!--<MediaTemplate />-->
    <Media Id="1" Cabinet="DISConfigurationCloud.cab" EmbedCab="yes" />
    
    <PropertyRef Id="IISMAJORVERSION"/>
    <Property Id="DB_SERVER_ADDRESS" Value="localhost"></Property>
    <Property Id="DB_SERVER_LOGIN_NAME" Value="DIS"></Property>
    <Property Id="DB_SERVER_PASSWORD" Value="D!S@OMSG.msft"></Property>
    <Property Id="DB_NAME" Value="DISConfigurationCloud"></Property>
    <Property Id="IS_INSTALLING_MEMBERSHIPDB" Value="true"></Property>
    <Property Id="IS_INSTALLING_CLOUDDATADB" Value="true"></Property>
    <Property Id="APP_SERVER_APP_POOL_NAME" Value="DISConfigurationCloudAppPool"></Property>
    <Property Id="APP_SERVER_SITE_NAME" Value="DISConfigurationCloud"></Property>
    <Property Id="APP_SERVER_SITE_ROOT_DIRECTORY" Value="C:\DISConfigurationCloud"></Property>
    <Property Id="APP_SERVER_SITE_PORT_NUMBER" Value="8818"></Property>
    <Property Id="BUSINESS_DB_BACKUP_LOCATION" Value="C:\DISConfigurationCloudData\Backup"></Property>
    <WixVariable Id="WixUILicenseRtf" Value="..\Resources\License.rtf" />
    <PropertyRef Id="NETFRAMEWORK40FULL"/>
    <PropertyRef Id="NETFRAMEWORK40FULL_SERVICING_LEVEL"/>
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLLOCATION" />
    <Property Id="WIX_DOWNGRADE_DETECTED" Secure="yes" />
    <Property Id="WIX_UPGRADE_DETECTED" Secure="yes" />
    <Property Id="DB_CONNECTIONTESTTOOL_EXCEPTION"/>
    
    <UIRef Id="InstallationWizard"/>
    
		<Feature Id="DatabaseFeature" Title="DIS Configuration Cloud Database" Level="1">
      <ComponentGroupRef Id="DISConfigurationCloudDatabaseComponents"/>
		</Feature>

    <Feature Id="ApplicationFeature" Title="DIS Configuration Cloud Application" Level="1">
      <ComponentGroupRef Id="DISConfigurationCloudApplicationComponents"/>
    </Feature>

    <InstallExecuteSequence>
      <Custom Action="CreateAspNetMembershipAction" Before="InstallValidate">
        <![CDATA[NOT (Installed) AND NOT (DatabaseFeature = 3)]]>
      </Custom>
    </InstallExecuteSequence>
    
	</Product>
</Wix>