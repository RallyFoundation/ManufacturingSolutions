<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>User Rule Configuration</title>
    <link rel="stylesheet" type="text/css" href="Content/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="Content/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="Content/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="Content/style.css" />
    <link rel="stylesheet" type="text/css" href="Content/ngDialog-theme-default.css" />
    <link rel="stylesheet" type="text/css" href="Content/ngDialog.css" />
    <link rel="stylesheet" type="text/css" href="Content/ngDialog.min.css" />
    <script src="Scripts/angular.js"></script>
    <script src="Scripts/angular.min.js"></script>
    <script src="Scripts/angular-mocks.js"></script>
    <script src="Scripts/angular-aria.js"></script>
    <script src="Scripts/angular-aria.min.js"></script>
    <script src="Scripts/angular-animate.js"></script>
    <script src="Scripts/angular-animate.min.js"></script>
    <script src="Scripts/angular-cookies.js"></script>
    <script src="Scripts/angular-cookies.min.js"></script>
    <script src="Scripts/angular-loader.js"></script>
    <script src="Scripts/angular-loader.min.js"></script>
    <script src="Scripts/angular-message-format.js"></script>
    <script src="Scripts/angular-message-format.min.js"></script>
    <script src="Scripts/angular-messages.js"></script>
    <script src="Scripts/angular-messages.min.js"></script>
    <script src="Scripts/angular-resource.js"></script>
    <script src="Scripts/angular-resource.min.js"></script>
    <script src="Scripts/angular-route.js"></script>
    <script src="Scripts/angular-route.min.js"></script>
    <script src="Scripts/angular-sanitize.js"></script>
    <script src="Scripts/angular-sanitize.min.js"></script>
    <script src="Scripts/angular-scenario.js"></script>
    <script src="Scripts/angular-touch.js"></script>
    <script src="Scripts/angular-touch.min.js"></script>
    <script src="Scripts/ngDialog.js"></script>
    <script src="Scripts/ngDialog.min.js"></script>
    <script src="Scripts/app.js"></script>
    <script src="../../../Config/user-rule.json"></script>
</head>
<body ng-app="HQATool">
    <div ng-controller="ValidationRuleConfigController" ng-init="loadData()">
        <p>
            &nbsp;&nbsp;
            <a href="#" class="btn btn-info btn-lg" ng-click="closeWindow()">Close</a>
            &nbsp;
            <a href="#" class="btn btn-info btn-lg" ng-click="saveRuleConfig()">Save</a>
        </p>
        <ol>
            <li ng-repeat="fieldName in fieldNames">
                <p style="font-weight:bolder;text-decoration:underline;font-style:italic">{{fieldName}}</p>
                <ol>
                    <li ng-repeat="ruleItem in ruleItems" ng-show="(ruleItem.FieldName == fieldName)">
                        <p  ng-style="((ruleItem.GroupName == 'System') && {'color' : 'orange'}) || ((voilatedRules.indexOf(ruleItem.id) >= 0) && {'color' : 'red'})">{{getRuleDescription(ruleItem)}}
                            &nbsp;&nbsp;<a href="#" ng-show="(ruleItem.GroupName == 'System')" ng-click="removeValue(ruleItems, $index)">Remove</a>
                        </p>
                        
                    </li>
                </ol>
                <a href="#" ng-click="newRule(fieldName)" ng-show="(newItems[fieldName] == null)">Add My Rule...</a>            
                <div ng-show="(newItems[fieldName] != null)">
                    <table>
                        <tr>
                            <td colspan="2">
                                <a href="#" ng-show="(voilatingFields[fieldName] == null)" ng-click="appendNewRule(fieldName)">OK</a>
                                &nbsp;
                                <a href="#" ng-click="cancelNewRule(fieldName)">Cancel</a>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <select ng-model="newItems[fieldName].RuleType" class="form-control" title="The type of the rule, select one from the drop down list.">
                                    <option value="EqualTo" ng-show="((fieldName == 'SmbiosSystemManufacturer') || (fieldName == 'SmbiosSystemFamily') || (fieldName == 'SmbiosSystemProductName') || (fieldName == 'SmbiosBoardProduct') || (fieldName == 'SmbiosSkuNumber') || (fieldName == 'ChassisType'))">Equal To</option>
                                    <option value="InRange" ng-show="(fieldName == 'PrimaryDiskType')">In</option>
                                    <option value="OutOfRange" ng-show="((fieldName == 'SmbiosSystemSerialNumber') || (fieldName == 'SmbiosUuid') || (fieldName == 'PrimaryDiskType'))">Not In</option>
                                    <option value="Contain" ng-show="((fieldName == 'SmbiosSystemManufacturer') || (fieldName == 'SmbiosSystemFamily') || (fieldName == 'SmbiosSystemProductName') || (fieldName == 'SmbiosBoardProduct') || (fieldName == 'SmbiosSkuNumber') || (fieldName == 'SmbiosSystemSerialNumber'))">Contain</option>
                                    <option value="NotContain" ng-show="((fieldName == 'SmbiosSystemManufacturer') || (fieldName == 'SmbiosSystemFamily') || (fieldName == 'SmbiosSystemProductName') || (fieldName == 'SmbiosBoardProduct') || (fieldName == 'SmbiosSkuNumber') || (fieldName == 'SmbiosSystemSerialNumber'))">Not Contain</option>
                                    <option value="StringLength" ng-show="(fieldName == 'SmbiosSystemSerialNumber') || (fieldName == 'SmbiosUuid')">Length</option>
                                    <option value="Min" ng-show="((fieldName == 'PrimaryDiskTotalCapacity') || (fieldName == 'TotalPhysicalRAM') || (fieldName == 'DisplaySizePhysicalY') || (fieldName == 'DisplaySizePhysicalH'))">Min</option>
                                    <option value="Max" ng-show="((fieldName == 'PrimaryDiskTotalCapacity') || (fieldName == 'TotalPhysicalRAM') || (fieldName == 'DisplaySizePhysicalY') || (fieldName == 'DisplaySizePhysicalH'))">Max</option>
                                    <option value="MinAndMax" ng-show="((fieldName == 'PrimaryDiskTotalCapacity') || (fieldName == 'TotalPhysicalRAM') || (fieldName == 'DisplaySizePhysicalY') || (fieldName == 'DisplaySizePhysicalH'))">Between</option>
                                </select>
                            </td>
                            <td>
                                <div ng-switch="newItems[fieldName].RuleType">
                                    <div ng-switch-when="EqualTo">
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="50" title="Field value." />
                                    </div>
                                    <div ng-switch-when="NotEqualTo">
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="50" title="Field value." />
                                    </div>
                                    <div ng-switch-when="Contain">
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="50" title="Field value." />
                                    </div>
                                    <div ng-switch-when="NotContain">
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="50" title="Field value." />
                                    </div>
                                    <div ng-switch-when="Reference">
                                        <input type="text" ng-model="newItems[fieldName].ReferenceFieldName" class="form-control" maxlength="50" onkeyup="purgeValue(valuePolicy.AlphaNum, this)" onmouseout="purgeValue(valuePolicy.AlphaNum, this)" title="Field name, the name of the referenced field." />
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" class="form-control" maxlength="50" onkeyup="purgeValue(valuePolicy.AlphaNum, this)" onmouseout="purgeValue(valuePolicy.AlphaNum, this)" title="Field value." />
                                    </div>
                                    <div ng-switch-when="ReferenceInRange">
                                        <input type="text" ng-model="newItems[fieldName].ReferenceFieldName" class="form-control" maxlength="50" onkeyup="purgeValue(valuePolicy.AlphaNum, this)" onmouseout="purgeValue(valuePolicy.AlphaNum, this)" title="Field name, the name of the referenced field." />
                                        <textarea ng-model="newItems[fieldName].ExpectedValues" class="form-control" title="Expected values. Type into one or more expected value(s), and separate each of them with a comma (,)." ng-list="," ng-trim="true"></textarea>
                                        <ul>
                                            <li ng-repeat="val in newItems[fieldName].ExpectedValues">{{val}}</li>
                                        </ul>
                                    </div>
                                    <div ng-switch-when="NumberSequenceComparison">
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" class="form-control" maxlength="50" title="Field value." />
                                        <input type="text" ng-model="newItems[fieldName].SequenceSeparator" class="form-control" maxlength="50" title="Sequence separator, i.e., '.', or ',', etc." />
                                        <input type="number" ng-model="newItems[fieldName].SequenceIndex" class="form-control" maxlength="50" title="Sequence index, the index of the sequence to focus." />
                                    </div>
                                    <div ng-switch-when="Min">
                                        <input type="number" ng-model="newItems[fieldName].MinValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="20" title="Min value." />
                                    </div>
                                    <div ng-switch-when="Max">
                                        <input type="number" ng-model="newItems[fieldName].MaxValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="20" title="Max value." />
                                    </div>
                                    <div ng-switch-when="InRange">
                                        <textarea ng-model="newItems[fieldName].ExpectedValues" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" title="Expected values. Type into one or more expected value(s), and separate each of them with a comma (,)." ng-list="," ng-trim="true"></textarea>
                                        <ul>
                                            <li ng-repeat="val in newItems[fieldName].ExpectedValues">{{val}}</li>
                                        </ul>
                                    </div>
                                    <div ng-switch-when="OutOfRange">
                                        <textarea ng-model="newItems[fieldName].UnexpectedValues" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" title="Unexpected values. Type into one or more unexpected value(s), and separate each of them with a comma (,)." ng-list="," ng-trim="true"></textarea>
                                        <ul>
                                            <li ng-repeat="val in newItems[fieldName].UnexpectedValues">{{val}}</li>
                                        </ul>
                                    </div>
                                    <div ng-switch-when="InAndOutOfRange">
                                        <table class="table">
                                            <tr>
                                                <td>
                                                    <textarea ng-model="newItems[fieldName].ExpectedValues" class="form-control" title="Expected values. Type into one or more expected value(s), and separate each of them with a comma (,)." ng-list="," ng-trim="true"></textarea>
                                                    <ul>
                                                        <li ng-repeat="val in newItems[fieldName].ExpectedValues">{{val}}</li>
                                                    </ul>
                                                </td>
                                                <td>
                                                    <textarea ng-model="newItems[fieldName].UnexpectedValues" class="form-control" title="Unexpected values. Type into one or more unexpected value(s), and separate each of them with a comma (,)." ng-list="," ng-trim="true"></textarea>
                                                    <ul>
                                                        <li ng-repeat="val in newItems[fieldName].UnexpectedValues">{{val}}</li>
                                                    </ul>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div ng-switch-when="StringLength">
                                        <input type="number" ng-model="newItems[fieldName].MinValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="20" title="Min value." />
                                        <input type="number" ng-model="newItems[fieldName].MaxValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" class="form-control" maxlength="20" title="Max value." />
                                    </div>
                                    <div ng-switch-when="MinAndMax">
                                        <input type="number" ng-model="newItems[fieldName].MinValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="20" title="Min value." />
                                        <input type="number" ng-model="newItems[fieldName].MaxValue" ng-change="checkFieldRuleValue(fieldName, newItems[fieldName])" ng-mouseleave="speakOutText(fieldName)" class="form-control" maxlength="20" title="Max value." />
                                    </div>
                                    <div ng-switch-when="Occurrence">
                                        <input type="number" ng-model="newItems[fieldName].MinValue" class="form-control" maxlength="20" title="Min value." />
                                        <input type="number" ng-model="newItems[fieldName].MaxValue" class="form-control" maxlength="20" title="Max value." />
                                    </div>
                                    <div ng-switch-when="Custom">
                                        <input type="text" ng-model="newItems[fieldName].FieldValue" class="form-control" maxlength="80" title="Regular Expression pattern that constrains field's value." />
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <br/>
            </li>
        </ol>
    </div>
    <script type="text/javascript">
        function createGuid() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        var valuePolicy = {
            AlphaNum: "alpha_num",
            Int: "int",
            Decimal: "decimal",
            DateTime: "datetime",
            Password: "password",
            DBCCase: "dbc_case"
        };

        function purgeValue(policy, source) {
            switch (policy) {
                case valuePolicy.AlphaNum:
                    {
                        source.value = source.value.replace(/[^a-zA-Z0-9_\-\.]/g, '');
                        break;
                    }
                case valuePolicy.Int:
                    {
                        source.value = source.value.replace(/[^\d]/g, '');
                        break;
                    }
                case valuePolicy.Decimal:
                    {
                        source.value = source.value.replace(/[^0-9\.]/g, '');
                        break;
                    }
                case valuePolicy.Password:
                    {
                        break;
                    }
                case valuePolicy.DBCCase:
                    {
                        source.value = source.value.replace(/[\uFF00-\uFFFF]/g, '');
                        source.value = source.value.replace(/[\u4E00-\u9FA5]/g, '');
                        break;
                    }
                default:
                    {
                        source.value = source.value.replace(/[\uFF00-\uFFFF]/g, '');
                        source.value = source.value.replace(/[\u4E00-\u9FA5]/g, '');
                        break;
                    }
            }
        }

        var settings = Settings.Data;

        var appModule = angular.module("HQATool", ['ngDialog']).controller("ValidationRuleConfigController",

        function ($scope, $location, $http, ngDialog) {

            $scope.ruleItems = [];

            $scope.fieldNames = [
                "SmbiosSystemManufacturer",
                "SmbiosSystemFamily",
                "SmbiosSystemProductName",
                "SmbiosBoardProduct",
                "SmbiosSkuNumber",
                "ChassisType",
                "SmbiosSystemSerialNumber",
                "SmbiosUuid",
                "TotalPhysicalRAM",
                "PrimaryDiskType",
                "PrimaryDiskTotalCapacity",
                "DisplaySizePhysicalH",
                "DisplaySizePhysicalY"
            ];

            $scope.newItems = {};

            $scope.fieldRuleDict = {};

            $scope.voilatedRules = [];

            $scope.voilatingFields = {};

            $scope.currentRuleItemIndex = -1;

            $scope.currentRuleItemName = "";

            $scope.currentRuleItem = null;

            $scope.getValueLength = function (value){
                return String(value).length;
            };

            $scope.loadData = function () {
                if ((settings != null) && (settings.length > 0)) {
                    for (var i = 0; i < settings.length; i++) {
                        $scope.ruleItems.push(settings[i]);
                    }
                }
            };

            $scope.setCurrentRuleItemIndex = function (index) {
                $scope.currentRuleItemIndex = index;
            };

            $scope.setRuleItemGroup = function (event, item) {
                if (event.target.checked == true) {
                    item.GroupName = "System";
                }
                else {
                    item.GroupName = "DEFAULT";
                }
            };

            $scope.newRule = function (fieldName) {
                if ($scope.newItems[fieldName] == null) {
                    var ruleId = createGuid();

                    var newItem = {
                        id: ruleId,
                        FieldName: fieldName,
                        GroupName: "System",
                        Enabled: false
                    };

                    var ruleTypes = $scope.getFieldRuleTypes(fieldName);

                    if ((ruleTypes != null) && (ruleTypes.length > 0)) {
                        newItem.RuleType = ruleTypes[0];
                    }

                    $scope.newItems[fieldName] = newItem;
                }

            };

            $scope.appendNewRule = function (fieldName) {
                if ($scope.newItems[fieldName] != null) {

                    var item = $scope.newItems[fieldName];

                    item.Enabled = true;

                    $scope.ruleItems.push(item);

                    $scope.newItems[fieldName] = null;
                }
            };

            $scope.cancelNewRule = function (fieldName) {
                if ($scope.newItems[fieldName] != null) {
                    
                    $scope.newItems[fieldName] = null;
                }

                if ($scope.voilatingFields[fieldName] != null) {
                    if ($scope.voilatedRules != null) {

                        var voilatatedRuleIndex = -1
                        for (var i = 0; i < $scope.voilatingFields[fieldName].length; i++) {
                            voilatatedRuleIndex = $scope.voilatedRules.indexOf($scope.voilatingFields[fieldName][i].RuleID);

                            if (voilatatedRuleIndex >= 0) {
                                $scope.voilatedRules.splice(voilatatedRuleIndex, 1);
                            }
                        }
                    }

                    $scope.voilatingFields[fieldName] = null;
                }
            };

            $scope.addRule = function () {
                var ruleId = createGuid();

                $scope.ruleItems.push(
                    {
                        id: ruleId,
                        FieldName: "SmbiosSystemManufacturer",
                        GroupName: "System",
                        Enabled: false,
                        RuleType: "EqualTo",
                        FieldValue: null
                    }
                );
            };

            $scope.copyRule = function (index) {
                if (index >= 0) {
                    var ruleId = createGuid();
                    var item = $scope.ruleItems[index];

                    var newItem = {
                        id: ruleId,
                        FieldName: item.FieldName,
                        GroupName: "System",
                        Enabled: false
                    };

                    var ruleTypes = $scope.getFieldRuleTypes(item.FieldName);

                    if ((ruleTypes != null) && (ruleTypes.length > 0)) {
                        newItem.RuleType = ruleTypes[0];
                    }

                    $scope.ruleItems.splice(index, 0, newItem);
                }
            };

            $scope.removeRule = function () {
                if ($scope.currentRuleItemIndex >= 0) {
                    $scope.ruleItems.splice($scope.currentRuleItemIndex, 1);
                    $scope.setCurrentRuleItemIndex(-1);
                }
            };

            $scope.removeValue = function (array, index) {
                if ((array != null) && (index >= 0)) {
                    array.splice(index, 1);
                }
            };

            $scope.setRuleItemQuotedFields = function (index, event) {
                if (event.keyCode == "13") {
                    if ($scope.ruleItems[index].QuotedFields == null) {
                        $scope.ruleItems[index].QuotedFields = [];
                    }

                    if ($scope.ruleItems[index].QuotedFields.indexOf($scope.ruleItems[index].currentInputValue) < 0) {
                        $scope.ruleItems[index].QuotedFields.push($scope.ruleItems[index].currentInputValue);

                        $scope.ruleItems[index].currentInputValue = null;
                    }
                }
            };

            $scope.setRuleItemExpectedValues = function (index, event) {
                if (event.keyCode == "13") {
                    if ($scope.ruleItems[index].ExpectedValues == null) {
                        $scope.ruleItems[index].ExpectedValues = [];
                    }

                    if ($scope.ruleItems[index].ExpectedValues.indexOf($scope.ruleItems[index].currentInputValue) < 0) {
                        $scope.ruleItems[index].ExpectedValues.push($scope.ruleItems[index].currentInputValue);

                        $scope.ruleItems[index].currentInputValue = null;
                    }
                }
            };

            $scope.setRuleItemUnexpectedValues = function (index, event) {
                if (event.keyCode == "13") {
                    if ($scope.ruleItems[index].UnexpectedValues == null) {
                        $scope.ruleItems[index].UnexpectedValues = [];
                    }

                    if ($scope.ruleItems[index].UnexpectedValues.indexOf($scope.ruleItems[index].currentInputAltValue) < 0) {
                        $scope.ruleItems[index].UnexpectedValues.push($scope.ruleItems[index].currentInputAltValue);

                        $scope.ruleItems[index].currentInputAltValue = null;
                    }
                }
            };

            $scope.saveRuleConfig = function () {
                var fileInfo = { Path: "", Content: "" };

                //fileInfo.Path = "..\\..\\Config\\rule.json";
                fileInfo.Path = "Config\\user-rule.json";
                fileInfo.Content = "Settings=" + JSON.stringify({ Data: $scope.ruleItems }) + ";";

                var fileInfoJson = JSON.stringify(fileInfo);

                event = new MessageEvent("WriteFile", { "view": window, "bubbles": false, "cancelable": true, 'data': fileInfoJson });
                document.dispatchEvent(event);
            };

            $scope.closeWindow = function () {
                event = new MessageEvent("CloseWindow", { "view": window, "bubbles": false, "cancelable": true, 'data': "Close" });
                document.dispatchEvent(event);
            };

            $scope.speakOutText = function (fieldName) {
                if (($scope.voilatingFields[fieldName] != null) && ($scope.voilatingFields[fieldName] != undefined)) {
                    var data = "";

                    for (var i = 0; i < $scope.voilatingFields[fieldName].length; i++) {
                        data += $scope.voilatingFields[fieldName][i].Description;

                        if (i != ($scope.voilatingFields[fieldName].length - 1)) {
                            data += " ";
                        }
                    }
                }

                event = new MessageEvent("SpeakText", { "view": window, "bubbles": false, "cancelable": true, 'data': (data + "|" )});
                document.dispatchEvent(event);
            };

            $scope.showProgress = function () {
                $scope.currentDialog = ngDialog.open({
                    scope: $scope,
                    className: 'ngdialog-theme-default',
                    template: 'progress-template.html',//'<img src=\"/theme/progress_blue.gif\" height=\"26\" width=\"26\"/><br/><p>Processing, please wait...</p>',
                    //plain: true,
                    showClose: false,
                    closeByDocument: false,
                    closeByEscape: false,
                    width: 100,
                    preCloseCallback: function (value) {
                        return true;
                    }
                });
            };

            $scope.hideProgress = function () {
                ngDialog.closeAll();
            };

            $scope.closeDialog = function () {
                ngDialog.closeAll();
            };

            $scope.getFieldRuleTypes = function (fieldName) {
                var ruleTypes = null;

                switch (fieldName)
                {
                    case "SmbiosSystemManufacturer": {
                        ruleTypes = ["EqualTo", "Contain", "NotContain"];
                        break;
                    }
                    case "SmbiosSystemFamily": {
                        ruleTypes = ["EqualTo", "Contain", "NotContain"];
                        break;
                    }
                    case "SmbiosSystemProductName": {
                        ruleTypes = ["EqualTo", "Contain", "NotContain"];
                        break;
                    }
                    case "SmbiosBoardProduct": {
                        ruleTypes = ["EqualTo", "Contain", "NotContain"];
                        break;
                    }
                    case "SmbiosSkuNumber": {
                        ruleTypes = ["EqualTo", "Contain", "NotContain"];
                        break;
                    }
                    case "ChasisType": {
                        ruleTypes = ["EqualTo"];
                        break;
                    }
                    case "SmbiosSystemSerialNumber": {
                        ruleTypes = ["StringLength", "OutOfRange", "Contain", "NotContain"];
                        break;
                    }
                    case "SmbiosUuid": {
                        ruleTypes = ["StringLength", "OutOfRange"];
                        break;
                    }
                    case "PrimaryDiskType": {
                        ruleTypes = ["InRange", "OutOfRange"];
                        break;
                    }
                    case "TotalPhysicalRAM": {
                        ruleTypes = ["Min", "Max", "MinAndMax"];
                        break;
                    }
                    case "PrimaryDiskTotalCapacity": {
                        ruleTypes = ["Min", "Max", "MinAndMax"];
                        break;
                    }
                    case "DisplaySizePhysicalH": {
                        ruleTypes = ["Min", "Max", "MinAndMax"];
                        break;
                    }
                    case "DisplaySizePhysicalY": {
                        ruleTypes = ["Min", "Max", "MinAndMax"];
                        break;
                    }
                }

                return ruleTypes;
            };

            $scope.getRuleTypeDisplayName = function (ruleType) {

                var displayName = ruleType;

                switch (ruleType)
                {
                    case "InRange": {
                        displayName = "In";
                        break;
                    }
                    case "OutOfRange": {
                        displayName = "Not In";
                        break;
                    }
                    case "MinAndMax": {
                        displayName = "Between";
                        break;
                    }
                    case "StringLength": {
                        displayName = "Length";
                        break;
                    }
                    case "NotNull": {
                        displayName = "Not Null";
                        break;
                    }
                    case "NotContain": {
                        displayName = "Not Contain";
                        break;
                    }
                    case "EqualTo": {
                        displayName = "Equal To";
                        break;
                    }
                    case "NotEqualTo": {
                        displayName = "Not Equal To";
                        break;
                    }
                    default: {
                        displayName = ruleType;
                        break;
                    }
                }

                return displayName;
            };

            $scope.getRuleDescription = function (ruleItem) {

                var ruleDescription = "";

                switch (ruleItem.RuleType) {
                    case "EqualTo": {
                        ruleDescription = "Value should equal to \"" + ruleItem.FieldValue + "\";";
                        break;
                    }
                    case "NotEqualTo": {
                        ruleDescription = "Value should NOT equal to \"" + ruleItem.FieldValue + "\";";
                        break;
                    }
                    case "NotNull": {
                        ruleDescription = "Value should NOT be null or empty;";
                        break;
                    }
                    case "InRange": {
                        ruleDescription = "Value should be of ";
                        for (var i = 0; i < ruleItem.ExpectedValues.length; i++) {
                            ruleDescription += "\"" + ruleItem.ExpectedValues[i] + "\"";
                            if (i != (ruleItem.ExpectedValues.length - 1)) {
                                ruleDescription += ", ";
                            }
                        }
                        break;
                    }
                    case "OutOfRange": {
                        ruleDescription = "Value should NOT be of ";
                        for (var i = 0; i < ruleItem.UnexpectedValues.length; i++) {
                            ruleDescription += "\"" + ruleItem.UnexpectedValues[i] + "\"";
                            if (i != (ruleItem.UnexpectedValues.length - 1)) {
                                ruleDescription += ", ";
                            }
                        }
                        break;
                    }
                    case "Contain": {
                        ruleDescription = "Value should at least contain the key word of \"" + ruleItem.FieldValue + "\";";
                        break;
                    }
                    case "NotContain": {
                        ruleDescription = "Value should NOT contain any piece of the key word of \"" + ruleItem.FieldValue + "\";";
                        break;
                    }
                    case "Min": {
                        ruleDescription = "Value should be greater than or equal to " + ruleItem.MinValue + ";";
                        break;
                    }
                    case "Max": {
                        ruleDescription = "Value should be less than or equal to " + ruleItem.MaxValue + ";";
                        break;
                    }
                    case "MinAndMax": {
                        ruleDescription = "Value should  both be greater than or equal to " + ruleItem.MinValue + ", and less than or equal to " + ruleItem.MaxValue + ";";
                        break;
                    }
                    case "StringLength": {
                        ruleDescription = "Value's character length should both be greater than or equal to " + ruleItem.MinValue + ", and less than or equal to " + ruleItem.MaxValue + ";";
                        break;
                    }
                    case "Occurrence": {
                        ruleDescription = "The occurrence of " + ruleItem.FieldName + " should both be greater than or equal to " + ruleItem.MinValue + ", and less than or equal to " + ruleItem.MaxValue + ";";
                        break;
                    }
                    default: {
                        break;
                    }
                }

                return ruleDescription;
            };

            $scope.checkFieldRuleValue = function (fieldName, ruleItem) {

                var fieldRules = $scope.fieldRuleDict[fieldName];

                var results = [];

                var voilatedRuleIndex = -1;

                if (fieldRules == null) {
                    $scope.fieldRuleDict[fieldName] = [];

                    for (var i = 0; i < $scope.ruleItems.length; i++) {
                        if ($scope.ruleItems[i].FieldName == fieldName) {
                            $scope.fieldRuleDict[fieldName].push($scope.ruleItems[i]);
                        }
                    }
                }

                if (fieldRules != null) {
                    for (var i = 0; i < fieldRules.length; i++) {
                        if ((fieldRules[i].RuleType == "InRange") && (ruleItem.RuleType == "EqualTo")) {
                            if (fieldRules[i].ExpectedValues.indexOf(ruleItem.FieldValue) < 0){
                                results.push({ RuleID: fieldRules[i].id, Description: "Rule value is not in the scope of the expected values of a built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "StringLength") && (ruleItem.RuleType == "EqualTo")) {
                            if ((ruleItem.FieldValue.length > fieldRules[i].MaxValue) || (ruleItem.FieldValue.length < fieldRules[i].MinValue)) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Rule value does not meet the character length limit of a built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "StringLength") && (ruleItem.RuleType == "StringLength")) {
                            if ((ruleItem.MaxValue > fieldRules[i].MaxValue) || (ruleItem.MinValue < fieldRules[i].MinValue)) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Character length limit is less strict than that of a built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "OutOfRange") && (ruleItem.RuleType == "EqualTo")) {
                            if (fieldRules[i].UnexpectedValues.indexOf(ruleItem.FieldValue) >= 0) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Rule value is in the scope of the unexpected values of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "InRange") && (ruleItem.RuleType == "Contain")) {
                            for (var j = 0; j < fieldRules[i].ExpectedValues.length; j++) {
                                if (fieldRules[i].ExpectedValues[j].indexOf(ruleItem.FieldValue) < 0) {
                                    results.push({ RuleID: fieldRules[i].id, Description: "Rule value of the key word conflicts with some of the expected values of a built-in rule." });
                                    if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                        $scope.voilatedRules.push(fieldRules[i].id);
                                    }

                                    break;
                                }
                                else {
                                    voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                    if (voilatedRuleIndex >= 0) {
                                        $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                    }
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "InRange") && (ruleItem.RuleType == "NotContain")) {
                            for (var j = 0; j < fieldRules[i].ExpectedValues.length; j++) {
                                if (fieldRules[i].ExpectedValues[j].indexOf(ruleItem.FieldValue) >=0) {
                                    results.push({ RuleID: fieldRules[i].id, Description: "Rule value of the key word conflicts with some of the expected values of a built-in rule." });
                                    if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                        $scope.voilatedRules.push(fieldRules[i].id);
                                    }

                                    break;
                                }
                                else {
                                    voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                    if (voilatedRuleIndex >= 0) {
                                        $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                    }
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "InRange") && (ruleItem.RuleType == "InRange")) {
                            for (var j = 0; j < fieldRules[i].ExpectedValues.length; j++) {
                                if (ruleItem.ExpectedValues.indexOf(fieldRules[i].ExpectedValues[j]) < 0) {
                                    results.push({ RuleID: fieldRules[i].id, Description: "The specified range of expected values is narrower than an exisiting defination of a built-in rule." });
                                    if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                        $scope.voilatedRules.push(fieldRules[i].id);
                                    }

                                    break;
                                }
                                else {
                                    voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                    if (voilatedRuleIndex >= 0) {
                                        $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                    }
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "InRange") && (ruleItem.RuleType == "OutOfRange")) {
                            for (var j = 0; j < fieldRules[i].ExpectedValues.length; j++) {
                                if (ruleItem.UnexpectedValues.indexOf(fieldRules[i].ExpectedValues[j]) >= 0) {
                                    results.push({ RuleID: fieldRules[i].id, Description: "Some of the values of the specified unexpected values also exists in exisiting expected values defination of a built-in rule." });
                                    if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                        $scope.voilatedRules.push(fieldRules[i].id);
                                    }

                                    break;
                                }
                                else {
                                    voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                    if (voilatedRuleIndex >= 0) {
                                        $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                    }
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "OutOfRange") && (ruleItem.RuleType == "InRange")) {
                            for (var j = 0; j < fieldRules[i].UnexpectedValues.length; j++) {
                                if (ruleItem.ExpectedValues.indexOf(fieldRules[i].UnexpectedValues[j]) >= 0) {
                                    results.push({ RuleID: fieldRules[i].id, Description: "Some of the values of the specified expected values also exists in exisiting unexpected values defination of a built-in rule." });
                                    if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                        $scope.voilatedRules.push(fieldRules[i].id);
                                    }

                                    break;
                                }
                                else {
                                    voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                    if (voilatedRuleIndex >= 0) {
                                        $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                    }
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "Min") && (ruleItem.RuleType == "Max")) {
                            if (fieldRules[i].MinValue > ruleItem.MaxValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Max value is less than the min value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "Max") && (ruleItem.RuleType == "Min")) {
                            if (fieldRules[i].MaxValue < ruleItem.MinValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Min value is greater than the max value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "MinAndMax") && (ruleItem.RuleType == "Min")) {
                            if (fieldRules[i].MaxValue < ruleItem.MinValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Min value is greater than the max value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "MinAndMax") && (ruleItem.RuleType == "Max")) {
                            if (fieldRules[i].MinValue > ruleItem.MaxValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Max value is less than the min value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "MinAndMax") && (ruleItem.RuleType == "MinAndMax")) {
                            if (fieldRules[i].MinValue > ruleItem.MaxValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Max value is less than the min value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else if (fieldRules[i].MaxValue < ruleItem.MinValue){
                                results.push({ RuleID: fieldRules[i].id, Description: "Min value is greater than the max value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "Min") && (ruleItem.RuleType == "MinAndMax")) {
                            if (fieldRules[i].MinValue > ruleItem.MaxValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Max value is less than the min value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                        else if ((fieldRules[i].RuleType == "Max") && (ruleItem.RuleType == "MinAndMax")) {
                            if (fieldRules[i].MaxValue < ruleItem.MinValue) {
                                results.push({ RuleID: fieldRules[i].id, Description: "Min value is greater than the max value of built-in rule." });
                                if ($scope.voilatedRules.indexOf(fieldRules[i].id) < 0) {
                                    $scope.voilatedRules.push(fieldRules[i].id);
                                }
                            }
                            else {
                                voilatedRuleIndex = $scope.voilatedRules.indexOf(fieldRules[i].id);
                                if (voilatedRuleIndex >= 0) {
                                    $scope.voilatedRules.splice(voilatedRuleIndex, 1);
                                }
                            }
                        }
                    }
                }

                if (results.length > 0) {
                    $scope.voilatingFields[fieldName] = results;
                }
                else {
                    $scope.voilatingFields[fieldName] = null;
                }

            };
        });
    </script>
</body>
</html>